server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Gzip compression
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    gzip_min_length 1000;

    # Cache static assets across all iterations
    location ~* ^/\d+/assets/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Iteration routing - each iteration is a separate Vite build in /iterations/N/
    location ~ ^/(\d+)(/.*)?$ {
        alias /usr/share/nginx/html/iterations/$1$2;
        try_files "" /iterations/$1/index.html;
    }

    # Root - show iteration index
    location = / {
        return 200 '<!DOCTYPE html>
<html>
<head>
    <title>JesseProjects Sandbox</title>
    <style>
        body { font-family: system-ui; max-width: 800px; margin: 50px auto; padding: 20px; background: #E8DDCB; color: #031634; }
        h1 { color: #036564; }
        ul { list-style: none; padding: 0; }
        li { margin: 10px 0; }
        a { color: #036564; text-decoration: none; font-size: 18px; font-weight: 500; }
        a:hover { text-decoration: underline; color: #F7941F; }
        .note { color: #666; font-size: 14px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>JesseProjects Sandbox</h1>
    <p>Available iterations:</p>
    <ul>
        <li><a href="/1/">Iteration 1</a></li>
        <li><a href="/2/">Iteration 2</a></li>
        <li><a href="/3/">Iteration 3</a></li>
        <li><a href="/4/">Iteration 4</a></li>
        <li><a href="/5/">Iteration 5</a></li>
    </ul>
    <p class="note">Each iteration is an independent build for review.</p>
</body>
</html>';
        add_header Content-Type text/html;
    }

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
}
